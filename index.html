<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oso Abrazos - Phaser</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-family: Arial, sans-serif;
        }
        #game-container { 
            border: 2px solid #333; 
            border-radius: 8px; 
            overflow: hidden;
        }
        .loading {
            color: white;
            font-size: 20px;
            text-align: center;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="loading" class="loading">ðŸ”„ Cargando Oso Abrazos...</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    
    <script>
        // ============= CONFIGURACIÃ“N GLOBAL =============
        window.gameState = {
            currentLevel: '1-1',
            score: 0,
            lives: 3,
            heartsCollected: 0,
            soundEnabled: true,
            gameStarted: false
        };

        // ============= CLASES DEL JUEGO =============
        class Oso extends Phaser.Physics.Arcade.Sprite {
            constructor(scene, x, y) {
                super(scene, x, y, 'oso_idle');
                scene.add.existing(this);
                scene.physics.add.existing(this);

                this.setCollideWorldBounds(true);
                this.setBounce(0.2);
                this.body.setSize(40, 60);
                this.body.setOffset(20, 20);

                this.hugging = false;
                this.hasUnicorn = false;
                this.invincible = false;
                this.direction = 1;
                this.hugCooldown = 0;

                this.createAnimations();
            }

            createAnimations() {
                this.anims.create({ key: 'idle', frames: [{ key: 'oso_idle' }], frameRate: 10 });
                this.anims.create({ key: 'walk', frames: [{ key: 'oso_walk' }], frameRate: 10 });
                this.anims.create({ key: 'jump', frames: [{ key: 'oso_jump' }], frameRate: 10 });
                this.anims.create({ key: 'hug', frames: [{ key: 'oso_hug' }], frameRate: 10, repeat: 0 });
            }

            update(cursors, spaceKey) {
                if (this.hugging) return;

                if (cursors.left.isDown) {
                    this.setVelocityX(-160);
                    this.direction = -1;
                    this.anims.play('walk', true);
                    this.setFlipX(true);
                } else if (cursors.right.isDown) {
                    this.setVelocityX(160);
                    this.direction = 1;
                    this.anims.play('walk', true);
                    this.setFlipX(false);
                } else {
                    this.setVelocityX(0);
                    this.anims.play('idle', true);
                }

                if (cursors.up.isDown && this.body.touching.down) {
                    this.setVelocityY(-330);
                    this.playSound('jump');
                }

                if (Phaser.Input.Keyboard.JustDown(spaceKey) && this.hugCooldown <= 0) {
                    this.hug();
                }

                if (this.hugCooldown > 0) this.hugCooldown--;
            }

            hug() {
                this.hugging = true;
                this.hugCooldown = 30;
                this.setVelocityX(0);
                this.anims.play('hug', true);
                this.playSound('hug');

                this.once('animationcomplete', () => {
                    this.hugging = false;
                    this.anims.play('idle', true);
                });
            }

            playSound(soundName) {
                if (window.gameState.soundEnabled && this.scene.sound.get(soundName)) {
                    this.scene.sound.play(soundName);
                }
            }
        }

        // ... (el resto del cÃ³digo igual que antes, pero revisado)
        
        // ============= INICIALIZACIÃ“N DEL JUEGO =============
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            backgroundColor: '#87CEEB',
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 800 },
                    debug: false
                }
            },
            scene: [BootScene, PreloadScene, MenuScene, GameScene],
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            }
        };

        const game = new Phaser.Game(config);
        console.log('ðŸŽ® Oso Abrazos inicializado!');
    </script>
</body>
</html>
